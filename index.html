<!DOCTYPE html>
<html>
<head>
    <title>并行DOM验证器</title>
    <style>
        .log { 
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
            height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="testArea">
        <button onclick="testNodeOperation()">测试节点操作</button>
        <button onclick="testDocumentAccess()">测试document访问</button>
        <button onclick="testDisconnectedNode()">测试游离节点</button>
    </div>
    
    <div class="log" id="accessLog"></div>
    <div class="log" id="structureLog"></div>

<script>
// 初始化日志系统
const accessLog = document.getElementById('accessLog');
const structureLog = document.getElementById('structureLog');

// 在你的Node.js拦截代码中添加日志记录（模拟）
const originalConsoleLog = console.log;
console.log = function(...args) {
    if(args[0].includes('node.') && args[0].includes('_getter')) {
        accessLog.innerHTML += `[属性路由] ${args[0]} ${new Date().toLocaleTimeString()}<br>`;
    }
    originalConsoleLog.apply(console, args);
};

// 测试用例
function testNodeOperation() {
    const div = document.createElement('div');
    div.innerHTML = `
        <parent>
            <child id="first">原始文本</child>
            <child id="second"></child>
        </parent>
    `;
    
    document.body.appendChild(div);
    updateStructureLog('节点操作后结构');
}

function testDocumentAccess() {
    const props = ['documentElement', 'body', 'head'];
    let output = 'document属性访问测试:<br>';
    
    props.forEach(prop => {
        output += `${prop}: ${JSON.stringify(document[prop].tagName)}<br>`;
    });
    
    accessLog.innerHTML += output;
}

function testDisconnectedNode() {
    const node = document.createElement('div');
    node.textContent = "游离节点";
    accessLog.innerHTML += `游离节点parentElement: ${node.parentElement}<br>`;
}

function updateStructureLog(action) {
    const walker = document.createTreeWalker(document, NodeFilter.SHOW_ALL);
    let structure = '';
    
    while(walker.nextNode()) {
        const node = walker.currentNode;
        structure += `${'  '.repeat(node.depth)}${node.nodeName}${node.id ? `#${node.id}` : ''}<br>`;
    }
    
    structureLog.innerHTML = `${action}结构：<br>${structure}`;
}

// 初始化时记录
updateStructureLog('初始');
</script>
</body>
</html>
